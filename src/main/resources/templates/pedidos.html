<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dash Flow - Control de Finanzas</title>

  <!-- Icons de Google -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp">

  <!-- CSS Externo -->
  <link rel="stylesheet" th:href="@{/css/pedidos.css}">

  <script defer src="./js/script.js"></script>
</head>

<body>

  <div class="container-JE">

    <!-- INICIO DE LA BARRA DE NAVEGACIÓN -->

    <aside class="aside-JE">
      <div class="top-JE">

        <div class="logo-JE">
          <img class="img-JE" th:src="@{/images/logo-dashboard.png}" alt="logo">
          <h2 class="h2-JE">DASH <span class="peligro-JE">FLOW</span></h2>
        </div>

        <div class="close-JE" id="close-btn-JE">
          <span class="material-icons-sharp">close</span>
        </div>

      </div>


      <div class="sidebar-JE">

        <a th:href="@{/dashboard}" class="hipervinculo-JE">
          <span class="material-icons-sharp">dashboard</span>
          <h3 class="h3-JE">Dashboard</h3>
        </a>

        <a th:href="@{/cuenta}" class="hipervinculo-JE">
          <span class="material-icons-sharp">person_outline</span>
          <h3 class="h3-JE">Cuenta</h3>
        </a>

        <a th:href="@{/productos}" class="hipervinculo-JE">
          <span class="material-icons-sharp">inventory</span>
          <h3 class="h3-JE">Productos</h3>
        </a>

        <a th:href="@{/ingresos}" class="hipervinculo-JE">
          <span class="material-icons-sharp">insights</span>
          <h3 class="h3-JE">Flujo de Ingresos</h3>
        </a>

        <a th:href="@{/pedidos}" class="hipervinculo-JE active-JE">
          <span class="material-icons-sharp">list_alt</span>
          <h3 class="h3-JE">Pedidos</h3>
          <span class="message-count-danger-JE">26</span>
        </a>

        <a th:href="@{/empleados}" class="hipervinculo-JE">
          <span class="material-icons-sharp">badge</span>
          <h3 class="h3-JE">Empleados</h3>
        </a>

        <a th:href="@{/tiers}" class="hipervinculo-JE">
          <span class="material-icons-sharp">workspace_premium</span>
          <h3 class="h3-JE">Tiers</h3>
          <span class="message-count-success-JE">Free</span>
        </a>

        <a th:href="@{/reportes}" class="hipervinculo-JE">
          <span class="material-icons-sharp">error_outline</span>
          <h3 class="h3-JE">Reportes</h3>
        </a>

        <form id="logoutForm" th:action="@{/logout}" method="post" style="display:none;"></form>
        <a onclick="document.getElementById('logoutForm').submit();" class="hipervinculo-JE" style="cursor: pointer;">
          <span class="material-icons-sharp">logout</span>
          <h3 class="h3-JE">Salir</h3>
        </a>

      </div>
    </aside>

    <!-- FIN DE LA BARRA DE NAVEGACIÓN -->

    <main class="main-JE">

      <div class="page-header-JE">
        <h1 class="h1-JE">Gestión de Pedidos</h1>
      </div>

      <div class="products-tabs-JE">
        <div class="tab-header-JE">
          <div class="tab-item-JE active-tab-JE" data-tab="dashboard">
            <span class="material-icons-sharp">analytics</span>
            <h3 class="h3-JE">Dashboard</h3>
          </div>
          <div class="tab-item-JE" data-tab="products">
            <span class="material-icons-sharp">inventory_2</span>
            <h3 class="h3-JE">Lista de Pedidos</h3>
          </div>
          <div class="tab-item-JE" data-tab="form">
            <span class="material-icons-sharp">add_box</span>
            <h3 class="h3-JE">Crear/Editar Pedido</h3>
          </div>
        </div>

        <div class="tab-content-JE">

          <div class="tab-pane-JE active-pane-JE" id="dashboard">

            <div class="stats-grid-JE">
              <div class="stat-card-JE">
                <div class="stat-icon-JE">
                  <span class="material-icons-sharp">inventory</span>
                </div>
                <div class="stat-content-JE">
                  <h3 class="h3-JE">Total Pedidos</h3>
                  <h2 class="h2-JE">1,247</h2>
                  <p class="p-JE exito-JE">+12% este mes</p>
                </div>
              </div>

              <div class="stat-card-JE">
                <div class="stat-icon-JE">
                  <span class="material-icons-sharp">trending_up</span>
                </div>
                <div class="stat-content-JE">
                  <h3 class="h3-JE">Pedidos Activos</h3>
                  <h2 class="h2-JE">1,156</h2>
                  <p class="p-JE exito-JE">92.7% del total</p>
                </div>
              </div>

              <div class="stat-card-JE">
                <div class="stat-icon-JE">
                  <span class="material-icons-sharp">pending_actions</span>
                </div>
                <div class="stat-content-JE">
                  <h3 class="h3-JE">Pedidos Pendientes</h3>
                  <h2 class="h2-JE">23</h2>
                  <p class="p-JE advertencia-JE">Requiere atención</p>
                </div>
              </div>

              <div class="stat-card-JE">
                <div class="stat-icon-JE">
                  <span class="material-icons-sharp">cancel_schedule_send</span>
                </div>
                <div class="stat-content-JE">
                  <h3 class="h3-JE">Pedidos Cancelados</h3>
                  <h2 class="h2-JE">8</h2>
                  <p class="p-JE peligro-JE">Revisar</p>
                </div>
              </div>
            </div>

            <div class="featured-products-JE">
              <h2 class="h2-JE">Pedidos Recientes</h2>

              <div class="featured-grid-JE">

                <div class="featured-card-JE">
                  <div class="featured-header-JE">
                    <div class="featured-badge-JE week-JE">
                      <span class="material-icons-sharp">star</span>
                      Pedido Grande - Semana
                    </div>
                  </div>
                  <div class="product-image-JE">
                    <img src="/placeholder.svg?height=120&width=120" alt="Cliente">
                  </div>
                  <div class="product-info-JE">
                    <h3 class="h3-JE">Pedido #SMG2024-001</h3>
                    <p class="p-JE text-muted-JE">Cliente: Juan Pérez</p>
                    <div class="product-stats-JE">
                      <div class="stat-JE">
                        <span class="material-icons-sharp">shopping_cart</span>
                        <span>5 ítems</span>
                      </div>
                      <div class="stat-JE">
                        <span class="material-icons-sharp">attach_money</span>
                        <span>$8,340.00</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="featured-card-JE">
                  <div class="featured-header-JE">
                    <div class="featured-badge-JE month-JE">
                      <span class="material-icons-sharp">emoji_events</span>
                      Pedido Grande - Mes
                    </div>
                  </div>
                  <div class="product-image-JE">
                    <img src="/placeholder.svg?height=120&width=120" alt="Cliente">
                  </div>
                  <div class="product-info-JE">
                    <h3 class="h3-JE">Pedido #LPT2024-042</h3>
                    <p class="p-JE text-muted-JE">Cliente: María García</p>
                    <div class="product-stats-JE">
                      <div class="stat-JE">
                        <span class="material-icons-sharp">shopping_cart</span>
                        <span>12 ítems</span>
                      </div>
                      <div class="stat-JE">
                        <span class="material-icons-sharp">attach_money</span>
                        <span>$12,500.00</span>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>

          <div class="tab-pane-JE" id="products">

            <div class="filters-section-JE">
              <div class="search-box-JE">
                <span class="material-icons-sharp">search</span>
                <input type="text" placeholder="Buscar pedidos..." id="searchInput">
              </div>

              <div class="filters-JE">
                <select id="categoryFilter">
                  <option value="">Todas las categorías</option>
                  <option value="pendiente">Pendiente</option>
                  <option value="procesando">Procesando</option>
                  <option value="enviado">Enviado</option>
                  <option value="entregado">Entregado</option>
                  <option value="cancelado">Cancelado</option>
                </select>

                <select id="statusFilter">
                  <option value="">Todos los estados</option>
                  <option value="pagado">Pagado</option>
                  <option value="no-pagado">No Pagado</option>
                </select>

                <button class="btn-secondary-JE" id="clearFilters">
                  <span class="material-icons-sharp">clear</span>
                  Limpiar
                </button>
              </div>
            </div>

            <div class="products-table-JE">
              <table id="productsTable">
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>Celular</th>
                    <th>Pedido</th>
                    <th>Monto</th>
                    <th>Fecha</th>
                    <th>E. Pedido</th>
                    <th>E. Pago</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="productsTableBody">
                  <tr th:each="p : ${pedidos}">
                    <td th:text="${p.nombreCliente}"></td>
                    <td th:text="${p.celularCliente}"></td>
                    <td th:text="${p.producto.nombre}"></td>
                    <td th:text="${p.montoTotal}"></td>
                    <td th:text="${p.fechaPedido}"></td>
                    <td>
                      <span th:text="${p.estadoPedido.displayName}" th:class="${p.estadoPedido.cssClass}">
                      </span>
                    </td>
                    <td>
                      <span th:text="${p.estadoPago.displayName}" th:class="${p.estadoPago.cssClass}">
                      </span>
                    </td>
                    <td>
                      <a th:href="@{/pedidos/editar(id=${p.id})}" class="btn-action-JE edit-btn">
                        <span class="material-icons-sharp">edit</span>
                      </a>
                      <a th:href="@{/pedidos/eliminar(id=${p.id})}" onclick="return confirm('¿Estás seguro?')"
                        class="btn-action-JE delete-btn">
                        <span class="material-icons-sharp">delete</span>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination-JE">
              <button class="pagination-btn-JE" id="prevPage">
                <span class="material-icons-sharp">chevron_left</span>
              </button>
              <div class="pagination-info-JE">
                <span>Página <span id="currentPage">1</span> de <span id="totalPages">10</span></span>
              </div>
              <button class="pagination-btn-JE" id="nextPage">
                <span class="material-icons-sharp">chevron_right</span>
              </button>
            </div>
          </div>

          <div class="tab-pane-JE" id="form">

            <div class="form-header-JE">
              <h2 class="h2-JE" id="formTitle">Crear Nuevo Pedido</h2>
              <button class="btn-secondary-JE" id="cancelForm">
                <span class="material-icons-sharp">close</span>
                Cancelar
              </button>
            </div>

            <form class="product-form-JE" id="productForm" th:action="@{/pedidos/guardar}" th:object="${pedido}"
              method="post">
              <input type="hidden" th:field="*{id}" />
              <div class="form-section-JE">
                <h3 class="h3-JE">Información del Pedido</h3>

                <div class="form-row-JE">
                  <div class="form-group-JE">
                    <label for="customerName">Nombre del Cliente *</label>
                    <input type="text" id="customerName" th:field="*{nombreCliente}" required>
                  </div>

                  <div class="form-group-JE">
                    <label for="orderDate">Fecha del Pedido *</label>
                    <input type="date" id="orderDate" th:value="${pedido.fechaPedido}" readonly>
                  </div>
                </div>

                <div class="form-row-JE">
                  <div class="form-group-JE">
                    <label for="customerEmail">Email del Cliente *</label>
                    <input type="email" id="customerEmail" th:field="*{emailCliente}" required>
                  </div>

                  <div class="form-group-JE">
                    <label for="customerTel">Celular del Cliente</label>
                    <input type="tel" id="customerTel" th:field="*{celularCliente}" required>
                  </div>
                </div>

                <div class="form-group-JE">
                  <label for="shippingAddress">Dirección de Envío</label>
                  <textarea id="shippingAddress" rows="4" th:field="*{direccionEnvio}" required></textarea>
                </div>
              </div>

              <div class="form-section-JE">
                <h3 class="h3-JE">Detalles de los Productos</h3>
                <div id="productItemsContainer">
                  <div class="product-item-JE">
                    <div class="form-group-JE">
                      <label for="productSelect1">Producto *</label>
                      <select id="productSelect1" th:field="*{producto.id}" required>
                        <option value="" selected disabled>Seleccionar producto</option>
                        <option th:each="prod : ${productos}" th:value="${prod.id}" th:text="${prod.nombre}">
                        </option>
                      </select>
                    </div>
                    <div class="form-group-JE">
                      <label for="quantity1">Cantidad *</label>
                      <input type="number" id="quantity1" min="1" value="1" th:field="*{cantidad}" required>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section-JE">
                <h3 class="h3-JE">Estado del Pedido</h3>

                <div class="form-row-JE">
                  <div class="form-group-JE">
                    <label for="paymentStatus">Estado de Pago *</label>
                    <select id="paymentStatus" th:field="*{estadoPago}" required>
                      <option th:each="ep : ${estadosPago}" th:value="${ep}" th:text="${ep.displayName}"></option>
                    </select>
                  </div>
                  <div class="form-group-JE">
                    <label for="orderStatus">Estado del Pedido *</label>
                    <select id="orderStatus" th:field="*{estadoPedido}" required>
                      <option th:each="ep : ${estadosPedido}" th:value="${ep}" th:text="${ep.displayName}">
                      </option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-actions-JE">
                <button type="button" class="btn-secondary-JE" id="resetForm">
                  <span class="material-icons-sharp">refresh</span>
                  Limpiar
                </button>
                <button type="submit" class="btn-primary-JE">
                  <span class="material-icons-sharp">save</span>
                  <span id="submitText">Guardar Pedido</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </main>

    <div class="right-JE">

      <div class="top-JE">
        <button id="menu-btn-JE">
          <span class="material-icons-sharp">menu</span>
        </button>
        <div class="theme-toggler-JE">
          <span class="material-icons-sharp active-JE">light_mode</span>
          <span class="material-icons-sharp">dark_mode</span>
        </div>
        <div class="profile-JE">
          <div class="info-JE">
            <p class="p-JE">Hey <b class="b-JE" th:text="${usuarioInfo.nombre}"></b></p>
            <small class="small-JE text-muted-JE" th:text="${usuarioInfo.rol}"></small>
          </div>
          <div class="profile-photo-JE">
            <img class="img-JE" src="./images/profile-1.jpg" alt="Foto de Perfil">
          </div>
        </div>
      </div>

      <div class="quick-actions-JE">
        <h2 class="h2-JE">Acciones Rápidas</h2>

        <button class="quick-action-btn-JE" id="addOrderBtn">
          <span class="material-icons-sharp">add</span>
          <div class="action-content-JE">
            <h4 class="h4-JE">Nuevo Pedido</h4>
            <p class="p-JE text-muted-JE">Registrar un nuevo pedido</p>
          </div>
        </button>

        <button class="quick-action-btn-JE" id="importOrdersBtn">
          <span class="material-icons-sharp">upload</span>
          <div class="action-content-JE">
            <h4 class="h4-JE">Listado Pedidos</h4>
            <p class="p-JE text-muted-JE">Ver todos los pedidos</p>
          </div>
        </button>

        <a class="quick-action-btn-JE" id="exportOrdersBtn" href="/pedidos/exportar" download>
          <span class="material-icons-sharp">download</span>
          <div class="action-content-JE">
            <h4 class="h4-JE">Exportar Datos</h4>
            <p class="p-JE text-muted-JE">Descargar lista de pedidos</p>
          </div>
        </a>
      </div>

      <div class="inventory-alerts-JE">
        <h2 class="h2-JE">Alertas de Pedidos</h2>

        <div class="alert-item-JE critical-JE">
          <div class="alert-icon-JE">
            <span class="material-icons-sharp">error</span>
          </div>
          <div class="alert-content-JE">
            <h4 class="h4-JE">Pedidos No Pagados</h4>
            <p class="p-JE">8 pedidos pendientes de pago</p>
            <button class="alert-action-JE">Revisar Pagos</button>
          </div>
        </div>

        <div class="alert-item-JE warning-JE">
          <div class="alert-icon-JE">
            <span class="material-icons-sharp">warning</span>
          </div>
          <div class="alert-content-JE">
            <h4 class="h4-JE">Pedidos Pendientes de Envío</h4>
            <p class="p-JE">23 pedidos por procesar</p>
            <button class="alert-action-JE">Preparar Envíos</button>
          </div>
        </div>

        <div class="alert-item-JE info-JE">
          <div class="alert-icon-JE">
            <span class="material-icons-sharp">info</span>
          </div>
          <div class="alert-content-JE">
            <h4 class="h4-JE">Pedidos Entregados</h4>
            <p class="p-JE">91 pedidos completados</p>
            <button class="alert-action-JE">Ver Historial</button>
          </div>
        </div>
      </div>

    </div>

  </div>

  <div class="modal-JE" id="confirmModal">
    <div class="modal-content-JE">
      <div class="modal-header-JE">
        <h3 class="h3-JE" id="modalTitle">Confirmar Acción</h3>
        <span class="modal-close-JE" id="modalClose">
          <span class="material-icons-sharp">close</span>
        </span>
      </div>
      <div class="modal-body-JE">
        <p class="p-JE" id="modalMessage">¿Estás seguro de que deseas realizar esta acción?</p>
      </div>
      <div class="modal-footer-JE">
        <button class="btn-secondary-JE" id="modalCancel">Cancelar</button>
        <button class="btn-danger-JE" id="modalConfirm">Confirmar</button>
      </div>
    </div>
  </div>

  <script th:src="@{/js/pedidos.js}"></script>

</body>

</html>